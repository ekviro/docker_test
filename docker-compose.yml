version: '3.8'

services:
  # –°–µ—Ä–≤–∏—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
  postgres:
    image: postgres:15  # –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ PostgreSQL
    container_name: my-postgres-db  # –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    environment:
      POSTGRES_DB: mydatabase      # —Å–æ–∑–¥–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
      POSTGRES_USER: myuser        # —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      POSTGRES_PASSWORD: mypassword # –∑–∞–¥–∞–µ–º –ø–∞—Ä–æ–ª—å
    ports:
      - "5432:5432"  # –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Ä—Ç 5432 –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—É
    volumes:
      - postgres_data:/var/lib/postgresql/data  # —Ç–æ–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ë–î
      - ./init-scripts:/docker-entrypoint-initdb.d  # —Å–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    restart: unless-stopped  # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏

  # –°–µ—Ä–≤–∏—Å –Ω–∞—à–µ–≥–æ FastAPI —Å–µ—Ä–≤–µ—Ä–∞
  server:
    build:
      context: .  # –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ - –∫–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
      dockerfile: server/Dockerfile  # –ø—É—Ç—å –∫ Dockerfile
    container_name: my-fastapi-server
    ports:
      - "8000:8000"  # –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Ä—Ç 8000 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API
    depends_on:
      - postgres  # –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ë–î
    environment:
      - DB_HOST=postgres  # üëà –¥–ª—è Docker
    restart: unless-stopped

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–º–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
volumes:
  postgres_data:  # —Ç–æ–º –¥–ª—è –¥–∞–Ω–Ω—ã—Ö PostgreSQL (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏)