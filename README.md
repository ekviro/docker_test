# docker_test
изучение докера

### Коротко: 
для запуска стандартных образов нужен только docker-compose.yml, который сам качает нужные образы из сети.
Для своих сборок контейнеров нужно писать Dockerfile.

Для запуска всех контейнеров из docker-compose.yml нужно  
в терминале из корневой папки
```
docker-compose up -d
```
Остановить контейнеры без удаления данных БД
```
docker-compose down
```
Остановить с удалением данных (volume), потом скрипты опять выполнятся при запуске
```
docker-compose down -v
```
### Подробно:  

docker-compose.yml - "Оркестратор контейнеров".
Это файл конфигурации, который описывает, как запускать один или несколько контейнеров.

Использует готовый образ СУБД (скачивает image: postgres:15 из Docker Hub - реестра образов)

Если готовых контейнеров не хватает, то нужен Dockerfile
Dockerfile - это текстовый файл с инструкциями, как собрать свой контейнер, если:
- нужно создать свой кастомный образ
- нужно установить дополнительные пакеты
- нужно изменить конфигурацию базового образа
### Запуск
В терминале из корневой папки
```
docker-compose up -d
```
-d нужно для того, чтобы выполнялось в фоновом режиме, не занимая основной терминал. 
Иначе если выключить терминал, то контейнеры остановятся  

Далее при первом запуске выполнится скрипт создания и заполнения БД:  
volumes:  
- postgres_data:/var/lib/postgresql/data  # Постоянное хранилище данных БД  
Синтаксис: имя_тома:путь_в_контейнере  
Что происходит:  
postgres_data - том Docker (виртуальный диск)  
/var/lib/postgresql/data - папка внутри контейнера где PostgreSQL хранит данные    
Результат: Данные БД сохраняются между перезапусками контейнера  


- ./init-scripts:/docker-entrypoint-initdb.d  # Скрипты выполняются при ПЕРВОМ запуске  
Синтаксис: локальный_путь:путь_в_контейнере  
Что происходит:  
./init-scripts - папка на твоем компьютере  
/docker-entrypoint-initdb.d - специальная папка в контейнере PostgreSQL  
Результат: Файлы из локальной папки доступны в контейнере  

Аналогия:
Том (postgres_data) - как флешка:  
Подключаешь к контейнеру  
Данные сохраняются даже если контейнер удалить  
Локальная папка (./init-scripts) - как общая папка:  
Синхронизация между компьютером и контейнером  
Изменения в локальных файлах сразу видны в контейнере  
